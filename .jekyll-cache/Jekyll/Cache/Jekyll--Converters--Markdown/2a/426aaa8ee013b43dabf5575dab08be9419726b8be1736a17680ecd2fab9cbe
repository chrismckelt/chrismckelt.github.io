I"Ó<p>Download source files:<a href="/file.axd?file=DBDeployExample.zip">DBDeployExample.zip (4.81 mb)</a></p>

<p>Here is a quick example of how to use <a href="http://dbdeploy.com/" title="http://dbdeploy.com/">DB Deploy</a></p>

<p>This example uses NANT to run DBDeploy which in turn generates the <em>output.sql</em> file.Â  This is then run against the database causing our changes to be run in and putting an entry in the ChangeLog table to tell you which sql files have been run.</p>

<p>To run this sample</p>

<ol>
  <li>Download to a location on your computer e.g. <em>C:\Examples\DBDeployExample</em></li>
  <li>Create a database onyour localhost called <em>DBDeployExample</em></li>
  <li>In a command prompt (Or <a href="http://www.microsoft.com/windowsserver2003/technologies/management/powershell/download.mspx" title="http://www.microsoft.com/windowsserver2003/technologies/management/powershell/download.mspx">PowerShell</a>) use <a href="http://nant.sourceforge.net/" title="http://nant.sourceforge.net/">NANT</a> to build the solution â€“(I have this setup as an environment variable setup and simply type â€˜NANTâ€™)</li>
  <li>NANT will build the default.build file and run the database changes</li>
</ol>

<p>Â </p>

<p>The NANT output should look like this</p>

<p>Â </p>

<p>Â </p>

<p><img src="images/image.axd?picture=dbdeploy-cmd1.png" alt="" /> <img src="images/image.axd?picture=dbdeploy-cmd2.png" alt="" /></p>

<p>Opening the solution file looks like this</p>

<p><img src="images/image.axd?picture=DBDeployExample-DirStructure.png" alt="" /></p>

<p>The database should now look like this</p>

<p><img src="images/image.axd?picture=dbdeploy-dbview.png" alt="" /></p>

<p>The ChangeLog table in the database is used by DBDeploy for change management and will look like this:</p>

<p>Â </p>

<p>Â </p>

<p><img src="images/image.axd?picture=dbdeploy-ChangeLogTable.png" alt="" /></p>

<p>Â </p>

<p>The default.build file contains a target that actions DBDeploy</p>

<p>&lt;target name=â€œscript.generateâ€ description=â€œgenerate a sql upgrade scriptâ€&gt;
&lt;call target=â€œsetup.changelogtableâ€/&gt;
&lt;call target=â€œsetup.builddirâ€/&gt;
&lt;echo message=â€œCalling dbdeploy with dbConnection=${connstring}â€¦â€ /&gt;
&lt;dbdeploy dbType=â€œmssqlâ€
dbConnection=â€${connstring}â€
dir=â€${script.dir}â€
outputFile=â€${output.file}â€
undoOutputFile=â€${undo.output.file}â€ /&gt;
&lt;echo message=â€œâ€¦finished calling dbdeploy.â€ /&gt;
&lt;/target&gt;</p>

<p>Â </p>

<p>The output file contains all change files found on the file system that are not contained in the ChangeLog table</p>

<p>The following command runs the output script against the database</p>

<p>Â </p>

<p>&lt;target name=â€œscript.executeâ€&gt;
&lt;echo message=â€œExecuting script ${script.execute.filename} against database ${database.name}â€¦â€ /&gt;
&lt;exec program=â€${sqlcmd}â€&gt;
&lt;arg value=â€${script.execute.extraparams}â€ /&gt;
&lt;arg value=â€œ-iâ€ /&gt;
&lt;arg value=â€${script.execute.filename}â€ /&gt;
&lt;arg value=â€œ-dâ€ /&gt;
&lt;arg value=â€${database.name}â€ /&gt;
&lt;arg value=â€œ-Sâ€/&gt;
&lt;arg value=â€${server}â€ /&gt;
&lt;/exec&gt;
&lt;echo message=â€œâ€¦finished executing script.â€ /&gt;
&lt;/target&gt;</p>
:ET