<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure D365 fo and event grid | Chris McKelt</title>

    <link href="/assets/css/rouge-github.css" rel="stylesheet">
    <link href="/assets/css/custom.css" rel="stylesheet">

    <link rel="alternate" type="application/atom+xml" title="Chris McKelt’s blog" href="/feed.xml">

    <link rel="canonical" href="http://0.0.0.0:4000/2019/02/05/configure-d365-fo-and-event-grid.html" />
  </head>
  <body>
    <header>
  <span class="font-semibold text-xl tracking-tight">
    mckelt.com
  </span>
  <div class="follow-btns">
    <a class="btn btn-twitter-round" href="https://twitter.com/chris_mckelt" target="_blank" rel="noopener noreferrer" alt="Twitter" title="Me on Twitter"><span class="sr-only">Twitter</span></a>
    <a class="btn btn-github-round" href="https://github.com/chrismckelt/" target="_blank" rel="noopener noreferrer" alt="GitHub" title="Me on GitHub"><span class="sr-only">GitHub</span></a>
    <a class="btn btn-rss-round" href="/feed.xml" target="_blank" alt="RSS" title="RSS"><span class="sr-only">RSS</span></a>
  </div>
</header>

    <nav>
      <ul>
        <li><a href="/">Posts</a></li>
        <li><a href="/about">About</a></li>
        <li><a href="/talks">Talks</a></li>
        <li><a href="/contact">Contact</a></li>
      </ul>
    </nav>

    <main>
      <article>
        <h2>Configure D365 fo and event grid</h2>
        <p class="publish-date">
  Published: <time datetime="2019-02-05">Feb 5, 2019</time>
  
  <br />
  
  By: <a rel="author"
    href="https://www.linkedin.com/in/"
    title="">
       
  </a>
</p>

        <h3 id="overview-on-how-to-publish-data-entity-changes-from-dynamics-finance-and-operations-to-azure-event-grid">Overview on how to publish data entity changes from Dynamics Finance and Operations to Azure Event Grid.</h3>

<h3 id="step-1">Step 1</h3>

<p>In D365FO, Navigate to the Business Events Catalogue page</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image.png" alt="image" /></p>

<h3 id="step-2">Step 2</h3>

<p>Navigate to the <em>endpoints</em> tab and select ‘Azure Event Grid’</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-1.png" alt="image" /></p>

<h3 id="step-3">Step 3</h3>

<p>In Azure, create an application service registration</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-2.png" alt="image" /></p>

<p><em>Take note of the Application Id and the Secret Id</em></p>

<h3 id="step-4">Step 4</h3>

<p>In Azure,  create an Azure Event Grid Topic</p>

<p><a href="https://customers.westus2-1.eventgrid.azure.net/api/events">https://customers.westus2-1.eventgrid.azure.net/api/events</a></p>

<p>Copy the Access Key</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-3.png" alt="image" /></p>

<h3 id="step-5">Step 5</h3>

<p>In Azure,  create an Azure Key Vault with a key called</p>

<p>key-eventgrid-topic-d365fo-customers</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-4.png" alt="image" /></p>

<p>The secret value is the Access Key for the Event Grid Topic</p>

<h3 id="step-6">Step 6</h3>

<p>On the key vault – grant access to the secret for the Application Registration</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-5.png" alt="image" /></p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-6.png" alt="image" /></p>

<h3 id="step-7">Step 7</h3>

<p>In D365FO ‘configure an endpoint’ and enter the Azure Event Grid Topic endpoint</p>

<p>It now requires the Application Id &amp; Application secret + the key vault name + name of secret in key vault (to get the Access Key)</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-7.png" alt="image" /></p>

<h3 id="step-8">Step 8</h3>

<p>An endpoint should now display</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-8.png" alt="image" /></p>

<h3 id="step-9">Step 9</h3>

<p>Activate the following 2 business events</p>

<ul>
  <li>BusinessEventsAlertEvent</li>
  <li>BusinessEventsDueDateAlertEvent</li>
</ul>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-9.png" alt="image" /></p>

<p>select your newly created endpoint</p>

<h3 id="step-10">Step 10</h3>

<p>From the customers list, create a custom alert</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-10.png" alt="image" /></p>

<p>Configure the alert to happen when the record is created, deleted or a field changes</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-11.png" alt="image" /></p>

<p><a href="https://docs.microsoft.com/en-us/dynamics365/fin-ops-core/dev-itpro/business-events/alerts-business-events">Ensure ‘Send Externally’ is true</a></p>

<h3 id="step-11">Step 11</h3>

<p>Edit the customer and change the field with the alert on it &amp; save the record</p>

<h3 id="step-12">Step 12</h3>

<p>view an alert &amp; business event arrives in the following table</p>

<p><a href="https://XXXXX.dynamics.com/Default.htm?mi=SysTableBrowser&amp;cmp=YYYY&amp;tablename=eventcud" title="https://clubassist-sand02.sandbox.operations.dynamics.com/Default.htm?mi=SysTableBrowser&amp;cmp=usmf&amp;tablename=eventcud">https://XXXXX.dynamics.com/Default.htm?mi=SysTableBrowser&amp;cmp=YYYY&amp;tablename=eventcud</a></p>

<p>XXXXX == your organisations URL<br />
YYYY == your company</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-14.png" alt="image" /></p>

<p>if no record appears here – you might need to fix your batch jobs</p>

<h3 id="step-13">Step 13</h3>

<p>Verify that your Azure Event Grid Topic has received the customer change events</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-12.png" alt="image" /></p>

<h3 id="step-14">Step 14</h3>

<p>The below payload structure is sent to Event Grid</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-13.png" alt="image" /></p>

<h1 id="subscribing-to-published-events-in-flow">Subscribing to published Events in Flow</h1>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2019/10/image-15.png" alt="image" /></p>

<h2 id="sample-extract-which-was-pushed-to-teams">Sample extract (which was pushed to teams)</h2>

<ul>
  <li>ID = BULK-002</li>
  <li>Event = LocationChanged</li>
  <li>Payload = {“BusinessEventId”:”BusinessEventsAlertEvent”,”ControlNumber”:5637145330,”Email”:”Chris.McKelt@xxx.com.au”,”EventId”:”D60A8657-E87C-43A8-8D7D-826EBF0490D7”,”EventTime”:”/Date(1570769681000)/”,”FieldId”:3,”Link”:””,”MajorVersion”:0,”Message”:”LocationChanged”,”MessageDetails”:”View Location: BULK-002, 24”,”MinorVersion”:0,”ParentTableId”:8565,”RuleId”:”000428”,”Subject”:”LocationChanged”,”TableId”:8565,”TypeTrigger”:”FieldChanged”,”UserId”:”Chris.McKelt”}</li>
</ul>

<p>Key Points for setting up change alerts in D365 FO</p>

<ol>
  <li>Alerts should be setup under 1 user with admin permissions (on test this is the dual write user)</li>
  <li>Setup  a Batch Group called INT (integration) and allocate servers to it</li>
  <li><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2020/02/image-11.png" alt="image" /></li>
  <li>   Ensure the Batch Job is setup as below (note the user)</li>
</ol>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2020/02/image-12.png" alt="image" /></p>

<h2 id="exported-logic-app--flow-example-to-listen-to-events-and-send-to-teams-channel">Exported Logic App / Flow Example to listen to events and send to Teams channel</h2>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images/2020/02/image-13.png" alt="image" /></p>

        <p>
  <a href="https://twitter.com/intent/tweet?text=Configure D365 fo and event grid&amp;url=http://0.0.0.0:4000/2019/02/05/configure-d365-fo-and-event-grid.html&amp;via=dzhavatushev" class="btn btn-twitter">
    <span class="label">Share on Twitter</span>
  </a>
</p>

      </article>
    </main>

    <script src="/assets/js/main.js"></script>
  </body>
</html>
