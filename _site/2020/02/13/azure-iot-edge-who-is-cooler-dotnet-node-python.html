<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure IoT Edge- Who is cooler? dotnet, node or python? | Chris McKelt</title>

    <link href="/assets/css/rouge-github.css" rel="stylesheet">
    <link href="/assets/css/custom.css" rel="stylesheet">

    <link rel="alternate" type="application/atom+xml" title="Chris McKelt’s blog" href="/feed.xml">

    <link rel="canonical" href="http://0.0.0.0:4000/2020/02/13/azure-iot-edge-who-is-cooler-dotnet-node-python.html" />
  </head>
  <body>
    <header>
  <span class="font-semibold text-xl tracking-tight">
    mckelt.com
  </span>
  <div class="follow-btns">
    <a class="btn btn-twitter-round" href="https://twitter.com/chris_mckelt" target="_blank" rel="noopener noreferrer" alt="Twitter" title="Me on Twitter"><span class="sr-only">Twitter</span></a>
    <a class="btn btn-github-round" href="https://github.com/chrismckelt/" target="_blank" rel="noopener noreferrer" alt="GitHub" title="Me on GitHub"><span class="sr-only">GitHub</span></a>
    <a class="btn btn-rss-round" href="/feed.xml" target="_blank" alt="RSS" title="RSS"><span class="sr-only">RSS</span></a>
  </div>
</header>

    <nav>
      <ul>
        <li><a href="/">Posts</a></li>
        <li><a href="/about">About</a></li>
        <li><a href="/talks">Talks</a></li>
        <li><a href="/contact">Contact</a></li>
      </ul>
    </nav>

    <main>
      <article>
        <h2>Azure IoT Edge- Who is cooler? dotnet, node or python?</h2>
        <p class="publish-date">
  Published: <time datetime="2020-02-13">Feb 13, 2020</time>
  
  <br />
  
  By: <a rel="author"
    href="https://www.linkedin.com/in/"
    title="">
       
  </a>
</p>

        <h1 id="series">Series</h1>

<p><a href="https://dev.to/chris_mckelt/azure-iot-edge-who-is-cooler-dotnet-node-or-python-369m">Part 1 - dotnet vs python vs node - temperature emission - who is cooler?</a><br />
<a href="https://dev.to/chris_mckelt/azure-iot-edge-developing-custom-modules-df3">Part 2 - Developing modules</a><br />
<a href="https://dev.to/chris_mckelt/azure-iot-edge-3rd-party-containers-3mi3">Part 3 - Custom Containers using Apache Nifi</a><br />
<a href="https://dev.to/chris_mckelt/azure-iot-edge-using-timescaledb-on-the-edge-2ec1">Part 4 - Custom Module using TimescaleDB</a><br />
<a href="https://dev.to/chris_mckelt/azure-iot-edge-using-grafana-on-the-edge-26na">Part 5 - Custom Module using Grafana</a></p>

<p><a href="file:///C:/temp/Part%205%20-%20Custom%20Module%20using%20Grafana"><br />
</a></p>

<h1 id="intro">Intro</h1>

<p>This code will run through creating an end to end demo of building &amp; deploying an <a href="https://docs.microsoft.com/en-us/azure/iot-edge/about-iot-edge">Azure IoT Edge solution</a> solution.</p>

<p>Code for this example lives here</p>

<h5 id="httpsgithubcomchrismckeltedgy"><a href="https://github.com/chrismckelt/edgy">https://github.com/chrismckelt/edgy</a></h5>

<h2 id="what-are-we-building">What are we building?</h2>

<p>This solution demonstrates an air-conditioning monitoring system where 3 room sensors are publishing their temperature over time.   When a room gets too hot the air conditioner for that room is turned on. Once the room is cooled it is turned off.</p>

<p>Three ‘data generator’ modules publish a message with the following properties.</p>

<ul>
  <li><em>Timestamp</em></li>
  <li><em>Temperature</em> –   room temp in Celsius</li>
  <li><em>IsAirConditionerOn</em> – true/false</li>
  <li><em>TagKey</em> – room name (in this case  dotnet, node, python)</li>
</ul>

<p>Three ‘data recorder’ modules subscribe to the published temperature messages and save the data in a time series database.</p>

<p>A custom module will listen to all temperature messages and analyse when a room is too hot. Sending a message to turn the rooms air conditioner on.</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images//76138797-6afb6a80-6085-11ea-93dd-2a8fda17583a.png" alt="" /></p>

<h2 id="demo-focus-areas">Demo Focus Areas</h2>

<ol>
  <li>show local debug/development options &amp;  remote/real deployment</li>
  <li>how to create and configure an Azure IOT Hub environment in Azure <a href="https://github.com/chrismckelt/edgy/tree/master/scripts/environment">using Azure CLI scripts</a></li>
  <li>coding custom modules in .Net, Python, NodeJS (sorry Java)</li>
  <li>using existing <a href="https://aka.ms/iot-edge-marketplace">Azure IoT Edge marketplace</a> modules</li>
  <li>using non-edge marketplace modules (docker images) to save data with <a href="https://www.timescale.com/">Timescale</a></li>
  <li>connecting a data flow engine ( <a href="https://nifi.apache.org/">Apache Nifi</a>) to the Edge <a href="https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-mqtt-support">MQTT Broker</a></li>
  <li>viewing the data through a <a href="https://grafana.com/">Grafana</a> dashboard.</li>
</ol>

<h1 id="getting-started">Getting started</h1>

<p>In order to develop solutions for the edge:</p>

<ol>
  <li>Read <a href="https://docs.microsoft.com/en-us/azure/iot-edge/how-to-vs-code-develop-module">Developing custom modules</a></li>
  <li>Setup your machine using the <a href="https://github.com/Azure/iotedgedev">Azure IoT EdgeHub Dev Tool</a></li>
  <li>I recommend installing these <a href="https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge">VS code extensions</a></li>
  <li>I recommend using <a href="https://www.portainer.io/">Portainer</a> for docker management both locally &amp; on the deployed edge solution</li>
</ol>

<h6 id="portainer-running-on-httplocalhost9000">Portainer running on <a href="http://localhost:9000/">http://localhost:9000/</a></h6>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images//76701501-ae487f80-66fc-11ea-861a-2f04c19bdf56.png" alt="" /></p>

<hr />

<h2 id="solution-overview">Solution Overview</h2>

<h2 id="azure-setup">Azure Setup</h2>

<p>You will need an <a href="https://azure.microsoft.com/en-us/pricing/details/iot-hub/">Azure IoT Hub</a> setup in Azure.   For this demo I am using the free tier</p>

<blockquote>
  <p>The IoT Hub Free Edition is intended to encourage proof of concept projects. It enables you to transmit up to a total of 8,000 messages per day, and register up to 500 device identities. The device identity limit is only present for the Free Edition.</p>
</blockquote>

<p>To build the environment I have used the Azure CLI and created scripts found <a href="https://github.com/chrismckelt/edgy/tree/master/scripts/environment">here</a>.   Run the top 3 on your selected subscription to create the artefacts in Azure below:</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images//77835944-caccc900-718c-11ea-815a-b75fc729905b.png" alt="" /></p>

<p>Running</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images//75735359-75d89700-5d35-11ea-8b46-9e5be2274d46.png" alt="" /></p>

<h2 id="modules">Modules</h2>

<p>The code contains the docker build files , code &amp; scripts to create the following modules</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images//75736364-fa2c1980-5d37-11ea-99f9-42eb41fb7ea1.png" alt="" /></p>

<h2 id="code">Code</h2>

<h4 id="descriptions-of-folders-and-files">Descriptions of folders and files</h4>

<table>
  <thead>
    <tr>
      <th>Folder /  File</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>config</td>
      <td>automatically generate files from the deployment.templates.json (debug or prod) that are used to deploy the solution</td>
    </tr>
    <tr>
      <td>modules</td>
      <td>custom code, docker images for your IOT Edge solution</td>
    </tr>
    <tr>
      <td>scripts</td>
      <td>code to create the environment, build the code/docker images and deploy the solution</td>
    </tr>
    <tr>
      <td>tools</td>
      <td>certificate generator and other tools for solution support</td>
    </tr>
    <tr>
      <td>.env</td>
      <td>holds environment variables that populate the generated config files from the templates</td>
    </tr>
    <tr>
      <td>deployment.debug.template.json</td>
      <td>  creates a file in the /config folder called ‘deployment.debug.json’ that populates environment variables, used for local development</td>
    </tr>
    <tr>
      <td>deployment.prod.template.json</td>
      <td>creates a file in the /config folder called ‘deployment.prod.json’ that populates environment variables, used for production like deployment</td>
    </tr>
  </tbody>
</table>

<h4 id="solution-structure-overview">Solution Structure Overview</h4>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images//75339444-81f2cd80-58cb-11ea-8c08-eb485e8b5e4b.png" alt="" /></p>

<h2 id="azure-iot-edge-devices">Azure IOT Edge Devices</h2>

<p>The solution used 3 devices which will be setup in a future post.</p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images//76172689-62b14580-61d3-11ea-8dd5-26fb9c1f4d40.png" alt="" /></p>

<h3 id="1-local-simulator">1. Local Simulator</h3>

<h5 id="a-simulated-local-environment-using-the-azure-iot-edge-hub-development-simulator-to-run-against-the-iot-hub-when-developing-for-the-edge-it-is-recommended-not-to-install-the-real-iot-edge-runtime-on-your-machine-but-instead-use-the-simulator">A simulated local environment using the <a href="https://github.com/Azure/iotedgehubdev">Azure IoT Edge Hub Development simulator to run against the IOT Hub.</a>   When developing for the edge it is recommended not to install <a href="https://docs.microsoft.com/bs-latn-ba/Azure/iot-edge/how-to-install-iot-edge-linux">the real ‘IOT edge runtime’</a> on your machine but instead use the simulator.</h5>

<h3 id="2-local-device">2. Local Device</h3>

<h5 id="linux-ubuntu-machine-hosted-in-vmware-on-my-local-machine-using-hyper-v">Linux Ubuntu machine hosted in VMWare on my local machine using Hyper V</h5>

<p><a href="https://docs.microsoft.com/bs-latn-ba/Azure/iot-edge/how-to-install-iot-edge-linux">https://docs.microsoft.com/bs-latn-ba/Azure/iot-edge/how-to-install-iot-edge-linux</a></p>

<p><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images//76173281-1d901200-61d9-11ea-9a9c-bdceacf476c9.png" alt="" /></p>

<h3 id="3-cloud-device">3. Cloud Device</h3>

<h5 id="linux-ubuntu-hosted-on-azure-in-our-resource-group-created-using-this-script">Linux Ubuntu hosted on Azure in our resource group <a href="https://github.com/chrismckelt/edgy/blob/master/scripts/environment/init.ps1">created using this script</a></h5>

<p>This uses the pre-existing <a href="https://azuremarketplace.microsoft.com/en-us/marketplace/apps/microsoft_iot_edge.iot_edge_vm_ubuntu?tab=overview">Linux Ubuntu image from the Azure Marketplace</a>  with the runtime installed.</p>

<p>Once up and running VS Code will show the devices below.</p>

<p><a href="https://user-images.githubusercontent.com/662868/76172706-870d2200-61d3-11ea-8c02-eb29f5813075.png" title="https://user-images.githubusercontent.com/662868/76172706-870d2200-61d3-11ea-8c02-eb29f5813075.png"><img src="https://raw.githubusercontent.com/chrismckelt/chrismckelt.github.io/master/_posts/posts/images//76172706-870d2200-61d3-11ea-8c02-eb29f5813075.png" alt="" /></a></p>

<h1 id="outro">Outro</h1>

<p>Now we have a view of the setup, development environment &amp; code, we can move onto the next post <a href="http://blog.mckelt.com/2020/03/09/azure-iot-edge-developing-custom-modules/">‘Developing custom modules for Azure IoT Edge’</a></p>

        <p>
  <a href="https://twitter.com/intent/tweet?text=Azure IoT Edge- Who is cooler? dotnet, node or python?&amp;url=http://0.0.0.0:4000/2020/02/13/azure-iot-edge-who-is-cooler-dotnet-node-python.html&amp;via=dzhavatushev" class="btn btn-twitter">
    <span class="label">Share on Twitter</span>
  </a>
</p>

      </article>
    </main>

    <script src="/assets/js/main.js"></script>
  </body>
</html>
