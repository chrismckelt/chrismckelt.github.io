<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Powershell script to delete mail from specific folder | Chris McKelt</title>

    <link href="/assets/css/rouge-github.css" rel="stylesheet">
    <link href="/assets/css/custom.css" rel="stylesheet">

    <link rel="alternate" type="application/atom+xml" title="Chris McKelt’s blog" href="/feed.xml">

    <link rel="canonical" href="http://0.0.0.0:4000/2012/10/18/powershell-script-to-delete-mail-from-specific-folder.html" />
  </head>
  <body>
    <header>
  <span class="font-semibold text-xl tracking-tight">
    mckelt.com
  </span>
  <div class="follow-btns">
    <a class="btn btn-twitter-round" href="https://twitter.com/chris_mckelt" target="_blank" rel="noopener noreferrer" alt="Twitter" title="Me on Twitter"><span class="sr-only">Twitter</span></a>
    <a class="btn btn-github-round" href="https://github.com/chrismckelt/" target="_blank" rel="noopener noreferrer" alt="GitHub" title="Me on GitHub"><span class="sr-only">GitHub</span></a>
    <a class="btn btn-rss-round" href="/feed.xml" target="_blank" alt="RSS" title="RSS"><span class="sr-only">RSS</span></a>
  </div>
</header>

    <nav>
      <ul>
        <li><a href="/">Posts</a></li>
        <li><a href="/about">About</a></li>
        <li><a href="/talks">Talks</a></li>
        <li><a href="/contact">Contact</a></li>
      </ul>
    </nav>

    <main>
      <article>
        <h2>Powershell script to delete mail from specific folder</h2>
        <p class="publish-date">
  Published: <time datetime="2012-10-18">Oct 18, 2012</time>
  
  <br />
  
  By: <a rel="author"
    href="https://www.linkedin.com/in/"
    title="">
       
  </a>
</p>

        <p> </p>

<p><a href="http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=function&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99">function</a> Remove-MailItem {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\[CmdletBinding(SupportsShouldProcess=$[true](http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=true&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99))\]            
</code></pre></div></div>

<p>param (</p>

<p>[parameter(Mandatory=$<a href="http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=true&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99">true</a>)]</p>

<p>[string]$mailfolder,</p>

<p>[string]$parentfolder</p>

<p>)</p>

<p>$ol = new-object -comobject “Outlook.Application”;</p>

<p># Map <a href="http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=to&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99">to</a> the MAPI namespace</p>

<p>$mapi = $ol.getnamespace(“mapi”);</p>

<p>$targetfolder  = ‘’</p>

<p><a href="http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=if&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99">if</a> ($parentfolder.Length -eq 0)</p>

<p>{</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$targetfolder = $mapi.Folders.Item(1).Folders.Item("Inbox").Folders.Item($mailfolder)
</code></pre></div></div>

<p>}</p>

<p><a href="http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=else&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99">else</a></p>

<p>{</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$targetfolder = $mapi.Folders.Item(1).Folders.Item("Inbox").Folders.Item($parentfolder).Folders.Item($mailfolder)
</code></pre></div></div>

<p>}</p>

<p>foreach ($item <a href="http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=in&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99">in</a> $targetfolder.Items)  {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	try {

		$item.[Delete](http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=Delete&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99)()       

	}

	catch \[[Exception](http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=Exception&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99)\]{

		[Write](http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=Write&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99)\-Host "Failed to delete item: " + $item.Subject

		[Write](http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=Write&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99)\-Host $\_.[Exception](http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=Exception&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99).ToString()

	}
</code></pre></div></div>

<p>}</p>

<p><a href="http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=function&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99">function</a> Clear-DeletedMail {</p>

<p>$outlook = New-Object -ComObject Outlook.Application</p>

<p>foreach ($folder <a href="http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=in&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99">in</a> $outlook.<a href="http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=Session&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99">Session</a>.Folders){</p>

<p>foreach($mailfolder <a href="http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=in&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99">in</a> $folder.Folders ) {</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[if](http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=if&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99) ($mailfolder.Name -eq "Deleted Items" -[and](http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=and&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99) $mailfolder.Items.[Count](http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=Count&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99) -gt 0){            

  foreach ($item [in](http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=in&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99) $mailfolder.Items){$item.[Delete](http://search.microsoft.com/default.asp?so=RECCNT&amp;siteid=us%2Fdev&amp;p=1&amp;nq=NEW&amp;qu=Delete&amp;IntlSearch=&amp;boolean=PHRASE&amp;ig=01&amp;i=09&amp;i=99)()}            

}               
</code></pre></div></div>

<p>}</p>

<p>}</p>

<p>}</p>

<p>}</p>

<p>Remove-MailItem -mailfolder “Cafe”</p>

<p>Remove-MailItem -mailfolder “COLSupport”</p>

<p>Remove-MailItem -mailfolder “Failed Logins” -parentfolder “COLSupport”</p>

<p>Remove-MailItem -mailfolder “IISReset” -parentfolder “COLSupport”</p>

<p>Remove-MailItem -mailfolder “Not Urgent” -parentfolder “COLSupport”</p>

<p>Remove-MailItem -mailfolder “Production” -parentfolder “COLSupport”</p>

<p> </p>

<p><a href="/blog/image.axd?picture=image_41.png"><img src="images/image.axd?picture=image_thumb_41.png" alt="image" title="image" /></a></p>

        <p>
  <a href="https://twitter.com/intent/tweet?text=Powershell script to delete mail from specific folder&amp;url=http://0.0.0.0:4000/2012/10/18/powershell-script-to-delete-mail-from-specific-folder.html&amp;via=dzhavatushev" class="btn btn-twitter">
    <span class="label">Share on Twitter</span>
  </a>
</p>

      </article>
    </main>

    <script src="/assets/js/main.js"></script>
  </body>
</html>
