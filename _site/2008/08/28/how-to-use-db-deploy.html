<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to use DB Deploy | Chris McKelt</title>

    <link href="/assets/css/rouge-github.css" rel="stylesheet">
    <link href="/assets/css/custom.css" rel="stylesheet">

    <link rel="alternate" type="application/atom+xml" title="Chris McKelt’s blog" href="/feed.xml">

    <link rel="canonical" href="http://0.0.0.0:4000/2008/08/28/how-to-use-db-deploy.html" />
  </head>
  <body>
    <header>
  <h1>Chris McKelt <span> Posts</span></h1>
  
  <div class="follow-btns">
    <a class="btn btn-twitter" href="https://twitter.com/chris_mckelt" target="_blank" rel="noopener noreferrer">
      Twitter
    </a><a class="btn btn-github" href="https://github.com/chrismckelt" target="_blank" rel="noopener noreferrer">
      GitHub
    </a><a class="btn btn-rss" href="/feed.xml" target="_blank">
      RSS
    </a>
  </div>
</header>


    <nav>
      <ul>
        <li><a href="/">Posts</a></li>
        <li><a href="/about">About</a></li>
        <li><a href="/talks">Talks</a></li>
        <li><a href="/contact">Contact</a></li>
      </ul>
    </nav>

    <main>
      <article>
        <h2>How to use DB Deploy</h2>
        <p class="publish-date">
  Published: <time datetime="2008-08-28">August 28, 2008</time>
  
</p>

        <p>Download source files:<a href="/file.axd?file=DBDeployExample.zip">DBDeployExample.zip (4.81 mb)</a></p>

<p>Here is a quick example of how to use <a href="http://dbdeploy.com/" title="http://dbdeploy.com/">DB Deploy</a></p>

<p>This example uses NANT to run DBDeploy which in turn generates the <em>output.sql</em> file.  This is then run against the database causing our changes to be run in and putting an entry in the ChangeLog table to tell you which sql files have been run.</p>

<p>To run this sample</p>

<ol>
  <li>Download to a location on your computer e.g. <em>C:\Examples\DBDeployExample</em></li>
  <li>Create a database onyour localhost called <em>DBDeployExample</em></li>
  <li>In a command prompt (Or <a href="http://www.microsoft.com/windowsserver2003/technologies/management/powershell/download.mspx" title="http://www.microsoft.com/windowsserver2003/technologies/management/powershell/download.mspx">PowerShell</a>) use <a href="http://nant.sourceforge.net/" title="http://nant.sourceforge.net/">NANT</a> to build the solution –(I have this setup as an environment variable setup and simply type ‘NANT’)</li>
  <li>NANT will build the default.build file and run the database changes</li>
</ol>

<p> </p>

<p>The NANT output should look like this</p>

<p> </p>

<p> </p>

<p><img src="images/image.axd?picture=dbdeploy-cmd1.png" alt="" /> <img src="images/image.axd?picture=dbdeploy-cmd2.png" alt="" /></p>

<p>Opening the solution file looks like this</p>

<p><img src="images/image.axd?picture=DBDeployExample-DirStructure.png" alt="" /></p>

<p>The database should now look like this</p>

<p><img src="images/image.axd?picture=dbdeploy-dbview.png" alt="" /></p>

<p>The ChangeLog table in the database is used by DBDeploy for change management and will look like this:</p>

<p> </p>

<p> </p>

<p><img src="images/image.axd?picture=dbdeploy-ChangeLogTable.png" alt="" /></p>

<p> </p>

<p>The default.build file contains a target that actions DBDeploy</p>

<p>&lt;target name=“script.generate” description=“generate a sql upgrade script”&gt;
&lt;call target=“setup.changelogtable”/&gt;
&lt;call target=“setup.builddir”/&gt;
&lt;echo message=“Calling dbdeploy with dbConnection=${connstring}…” /&gt;
&lt;dbdeploy dbType=“mssql”
dbConnection=”${connstring}”
dir=”${script.dir}”
outputFile=”${output.file}”
undoOutputFile=”${undo.output.file}” /&gt;
&lt;echo message=“…finished calling dbdeploy.” /&gt;
&lt;/target&gt;</p>

<p> </p>

<p>The output file contains all change files found on the file system that are not contained in the ChangeLog table</p>

<p>The following command runs the output script against the database</p>

<p> </p>

<p>&lt;target name=“script.execute”&gt;
&lt;echo message=“Executing script ${script.execute.filename} against database ${database.name}…” /&gt;
&lt;exec program=”${sqlcmd}”&gt;
&lt;arg value=”${script.execute.extraparams}” /&gt;
&lt;arg value=“-i” /&gt;
&lt;arg value=”${script.execute.filename}” /&gt;
&lt;arg value=“-d” /&gt;
&lt;arg value=”${database.name}” /&gt;
&lt;arg value=“-S”/&gt;
&lt;arg value=”${server}” /&gt;
&lt;/exec&gt;
&lt;echo message=“…finished executing script.” /&gt;
&lt;/target&gt;</p>

        <p>
  <a href="https://twitter.com/intent/tweet?text=How to use DB Deploy&amp;url=http://0.0.0.0:4000/2008/08/28/how-to-use-db-deploy.html&amp;via=dzhavatushev" class="btn btn-twitter">
    <span class="label">Share on Twitter</span>
  </a>
</p>

      </article>
    </main>

    <script src="/assets/js/main.js"></script>
  </body>
</html>
