<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows SharePoint Services Notes | Chris McKelt</title>

    <link href="/assets/css/rouge-github.css" rel="stylesheet">
    <link href="/assets/css/custom.css" rel="stylesheet">

    <link rel="alternate" type="application/atom+xml" title="Chris McKelt’s blog" href="/feed.xml">

    <link rel="canonical" href="http://0.0.0.0:4000/2008/10/12/windows-sharepoint-services-notes.html" />
  </head>
  <body>
    <header>
  <h1>Chris McKelt <span> Posts</span></h1>
  
  <div class="follow-btns">
    <a class="btn btn-twitter" href="https://twitter.com/chris_mckelt" target="_blank" rel="noopener noreferrer">
      Twitter
    </a><a class="btn btn-github" href="https://github.com/chrismckelt" target="_blank" rel="noopener noreferrer">
      GitHub
    </a><a class="btn btn-rss" href="/feed.xml" target="_blank">
      RSS
    </a>
  </div>
</header>


    <nav>
      <ul>
        <li><a href="/">Posts</a></li>
        <li><a href="/about">About</a></li>
        <li><a href="/talks">Talks</a></li>
        <li><a href="/contact">Contact</a></li>
      </ul>
    </nav>

    <main>
      <article>
        <h2>Windows SharePoint Services Notes</h2>
        <p class="publish-date">
  Published: <time datetime="2008-10-12">October 12, 2008</time>
  
</p>

        <p><strong>SharePoint main objects</strong></p>

<p>SPSite = Site Collection SPWeb = Site Web</p>

<p>SPSite siteCollection = new SPSite(“http://localhost/sites/sitename”); SPWeb web = siteCollection.OpenWeb();</p>

<p><strong>Features</strong></p>

<p>Features define a mechanism for defining site elements and adding them to a target site or site collection through a process called <em>feature activation</em></p>

<p>An example feature</p>

<p> &lt;Feature Id=“6AA03A00-02B5-4d83-A041-1CEB0DE9EF9E” Title=“Chris Document Manager” Description=“Test description” Version=“1.0.0.0”  Scope=“Web” ImageUrl=“TestImage.gif” ReceiverAssembly=“DocumentManager, Version=1.0.0.0, Culture=neutral, PublicKeyToken=52cb0cd67d773ef7” ReceiverClass=“DocumentManager.FeatureReceiver” xmlns=“http://schemas.microsoft.com/sharepoint/”&gt; &lt;ElementManifests&gt; &lt;ElementManifest Location=“elements.xml” /&gt; &lt;/ElementManifests&gt; &lt;/Feature&gt;</p>

<p><strong>Elements</strong></p>

<p> The element types that can be defined by a feature include</p>

<ul>
  <li>Menu commands</li>
  <li>Link commands</li>
  <li>Pages templates</li>
  <li>Page instances</li>
  <li>List definitions</li>
  <li>List instances</li>
  <li>Event handlers</li>
  <li>Workflows</li>
</ul>

<p>  &lt;Elements xmlns=“http://schemas.microsoft.com/sharepoint/”&gt; &lt;CustomAction  Id=“SiteActionsToolbar” GroupId=“SiteActions” Location=“Microsoft.SharePoint.StandardMenu” Sequence=“100” Title=“Hello World” Description=“A custom menu item added using a feature” ImageUrl=“_layouts/images/crtsite.gif” &gt;       &lt;UrlAction Url=“http://msdn.microsoft.com”/&gt; &lt;/CustomAction&gt; &lt;/Elements&gt;</p>

<p><strong>Configuration Elements</strong></p>

<p> </p>

<p>&lt;configuration&gt; &lt;configSections&gt; &lt;sectionGroup name=“SharePoint”&gt; &lt;section name=“SafeControls” type=””/&gt; &lt;section name=“RuntimeFilter” type=””/&gt; &lt;section name=“WebPartLimits” type=””/&gt; &lt;section name=“WebPartCache” type=””/&gt; &lt;section name=“WebPartWorkItem” type=””/&gt; &lt;section name=“WebPartControls” type=””/&gt; &lt;section name=“SafeMode” type=””/&gt; &lt;section name=“MergedActions” type=””/&gt; &lt;section name=“PeoplePickerWildCards” type=””/&gt; &lt;section name=“SafeControls” type=””/&gt; &lt;section name=“SafeControls” type=””/&gt; &lt;/sectionGroup&gt; &lt;/configSections&gt; &lt;SharePoint&gt; <SafeMode></SafeMode> <WebPartLimits></WebPartLimits> <WebPartCache></WebPartCache> <WebPartControls></WebPartControls> <SafeControls></SafeControls> <PeoplePickerWildCards></PeoplePickerWildCards> <MergedActions></MergedActions> <BlobCache></BlobCache> <RuntimeFilter></RuntimeFilter> &lt;/SharePoint&gt; &lt;/configuration&gt;</p>

<p><strong>SPVirtualPathProvider</strong></p>

<p>SPVirtualPathProvider allows files to be stored in the database – a term referred to as ‘ung_hosted_’</p>

<p>It can also retrieve pages from the file system ‘G_hosted_’ and pass them to the asp.net aspx page parser</p>

<p><strong>Pages Types</strong></p>

<p>Site Pages</p>

<ul>
  <li>Support customisation</li>
  <li>Have web parts and webpart zones</li>
</ul>

<p>Application Pages</p>

<ul>
  <li>Deployed as physical files (aspx) of the front end web server in the following location</li>
  <li>C: \program files \common files \microsoft shared \web server extensions \12 \template \layouts</li>
  <li>Inherit from LayoutsPageBase</li>
</ul>

<p><strong>Debugging WSS Components</strong></p>

<p>&lt;configuration&gt; &lt;SharePoint&gt; &lt;SafeMode CallStack=“true”/&gt; &lt;/SharePoint&gt; &lt;system.web&gt; &lt;customErrors mode=“Off”/&gt; &lt;compilation debug=“true”/&gt; &lt;/system.web&gt; &lt;/configuration&gt;</p>

<p><strong>SPFile</strong></p>

<p>SPWeb site = SPContext.Current.Web; SPFile homePage = site.GetFile(“default.aspx”)</p>

<p><strong>Default.master</strong></p>

<p>Resides in c: \program files \common files \microsoft shared \web server  extensions \12 \template \global \default.master</p>

<p><strong>Web Part Gallery</strong></p>

<p>Document library that contains serialised web parts.  There web parts have a <em>.webpart</em> extension (older WSS 2.0 were serialised using an old version with a .dwp extension)</p>

<p>Editor Web Part has 2 abstract methods to override to implement changes – <em>ApplyChanges</em> &amp; <em>SynchChanges</em></p>

<p><em>IWebPartField</em> interface is implemented by many WSS web parts – ie List View &amp; Image</p>

<p>HTTPHandler endpoints are the preferred data source for AJAX applications in which data is returned in a simple XML, text or JSON format representing the data query. This is a subset of the REST architecture pattern (Representational State Transfer).</p>

<p> IHttpAsynchHandler is the preferred interface for handlers that need long running tasks.</p>

<p><strong>Lists &amp; Content Types</strong></p>

<p>The create page contains built in list types broken out into sections including <em>libraries</em>, <em>communications</em>, <em>tracking</em> and <em>custom lists</em></p>

<p>WSS List definitions</p>

<ul>
  <li>Document library</li>
  <li>Form library</li>
  <li>Wiki page library</li>
  <li>Picture library</li>
  <li>Announcements</li>
  <li>Contacts</li>
  <li>Discussions</li>
  <li>Links</li>
  <li>Calendar</li>
  <li>Tasks</li>
  <li>Project tasks</li>
  <li>Issue tracking</li>
  <li>Custom list</li>
</ul>

<p>WSS list bast types</p>

<ul>
  <li>Standard lists = 0</li>
  <li>Document libraries = 1</li>
  <li>Discussion forums = 3</li>
  <li>Vote/Survey lists = 4</li>
  <li>Issue lists = 5</li>
</ul>

<p>  Lists store their data in columns (also called fields).  WSS 3.0 introduces site columns which are reusable fields</p>

<p>To have a custom field type recognised a <em>Field Schema</em> file is added in a CAML based syntax into a well known location.</p>

<p> Field types are defined in files name <em>fldtypes_companyName.xml</em> that must be deployed in <em>TEMPLATE\XML</em> directory</p>

<p> SPQuery query = new SPQuery(); query.ViewFields = @”<FieldRef Name="Title"></FieldRef><FieldRef Name="Expires"></FieldRef>”; query.Query = @”<Where> <Lt> <FieldRef Name="Expires"></FieldRef> <Value Type="DateTime"> <Today></Today></Value> </Lt> </Where>”; //NB://  <Where><operator><operand></operand><operand></operand></operator></Where></p>

<table>
  <tbody>
    <tr>
      <td>SPQuery object returns a SPListItemCollection</td>
      <td> </td>
      <td>  SPSiteDataQuery returns a datatable</td>
    </tr>
  </tbody>
</table>

<p>The built in columns are defined in the build-in fields feature</p>

<p><a href="http://blogs.msdn.com/andrew_may/archive/2006/05/24/SharePointBeta2WhatAreContentTypes.aspx" title="http://blogs.msdn.com/andrew_may/archive/2006/05/24/SharePointBeta2WhatAreContentTypes.aspx">Content Types</a>            —&gt;   <a href="http://blogs.msdn.com/andrew_may/archive/2006/06/24/SharePointBeta2WhatAreContentTypeIDs.aspx" title="http://blogs.msdn.com/andrew_may/archive/2006/06/24/SharePointBeta2WhatAreContentTypeIDs.aspx">Content Type Ids</a></p>

<p>Content types define underlying schema for either an item oin a list or a document in a document library.</p>

<p>Content types are either list based or document based.</p>

<p>A forms library is designed to store XML documents created from InfoPath forms.</p>

<p>A schema file must define content type references and its own separate data scheme as well as views and forms.</p>

<p>Create a custom document library in code – with 4 extended fields</p>

<p> </p>

<p>const string LIBRARY_NAME = “BeazleyTradeDocumentLibrary”;  SPSite siteCollection = new SPSite(“http://localhost:334”);SPWeb web = siteCollection.OpenWeb();if (!ListExists(web.Lists, LIBRARY_NAME)){Guid listId = siteCollection.RootWeb.Lists.Add(LIBRARY_NAME, “Beazley Trade Document Library”, SPListTemplateType.DocumentLibrary);SPList list = web.Lists[listId];list.Fields.Add(“BTProductId”, SPFieldType.Number, true);list.Fields.Add(“BTDocumentVersionNo”, SPFieldType.Number, true);list.Fields.Add(“BTProductName”, SPFieldType.Text, false);list.Fields.Add(“TemplateType”, SPFieldType.Text, false);SPField btProductIdField = list.Fields[“BTProductId”];btProductIdField.ShowInDisplayForm = true;btProductIdField.ShowInEditForm = true;btProductIdField.ShowInListSettings = true;btProductIdField.ShowInNewForm = true;btProductIdField.ShowInViewForms = true;SPView defaultView = list.Views[0];defaultView.ViewFields.Add(btProductIdField);defaultView.Update();list.ContentTypesEnabled = false;list.OnQuickLaunch = true;list.EnableAttachments = false;list.EnableVersioning = false;list.NoCrawl = true;list.Update();}</p>

<p> </p>

<p> </p>

<p><strong>Office Open XML</strong></p>

<p>Office Open XML file formats. Top level file such as Hello.docx is know as a <em>package</em>.</p>

<p>Inside a package are 2 kinds of internal components: <em>parts</em> and <em>items</em></p>

<p>In general, parts contain content and items contain metadata describing the parts.</p>

<p>Items can be further subdivided into <em>relationship items</em> and <em>content-type items</em></p>

<p>A part is an internal component containing content that is presisted inside the package.</p>

<p>The majority of parts are simple text files serialised as XML with an associated schema.</p>

<p>Open office xml file formats use relationships to define associations between a source and a target part.</p>

<p>A package relationship defines an association between the top level package and a part.</p>

<p>A part relationship defines an association between a parent part and a child part.</p>

<p> </p>

<p><em>Site definition</em> – is the top level component in WSS that aggregates smaller, more modular definitions to create a complete site template that can be used to provision sites.</p>

<p>Site definitions are deployed within the 12\TEMPLATE\SITETEMPLATES directory and are referenced in the 12\TEMPLATE\<culture>\\XML directory WEBTEMP.XML files where the <culture> folder is the locale identifier 12\\TEMPLATE\\1033\\XML for US English</culture></culture></p>

<p>Global site definitio - provides a common repository for site provision instructions required by every site definition.</p>

<p>The ONET.xml file serves as a high level manifest for the site definition and references the components that are to be used A feature can also be used to attach one or more other features to a site definition through a technique called <em>feature stapling</em> Localisation in WSS is based on language packs that are deployed as solutions packages</p>

<p>A _solution package_is a compressed .cab file with a .wsp extension containing the componentsto be deployed on a target web server. The .wsp file for a solutions package can be built using the MAKECAB operations system utility  by reading the definition from a .ddf file.</p>

<p>The .ddf file defines the output structure of the .wsp file by referencing each file in its source location and its destination location in the .wsp file.</p>

<p>The metadata for a solution package is maintained in a file named manifest.xml that must be added to the root of the .wsp file.  It is the manifest.xml that tells the WSS runtime which template files to copy into the WSS system directories.</p>

<p>WSS permission definitions</p>

<ol>
  <li>Environment permission</li>
  <li>Security Permission</li>
  <li>AspNetHostingPermission</li>
  <li>WebPermission</li>
</ol>

<p>SPSecurity allows code to run with higher priviledges</p>

<p> </p>

<p>SPSecurity.RunWithElevitedPrivaledges(</p>

<p>delegate{// code run as SharePoint\System}</p>

<p>)</p>

        <p>
  <a href="https://twitter.com/intent/tweet?text=Windows SharePoint Services Notes&amp;url=http://0.0.0.0:4000/2008/10/12/windows-sharepoint-services-notes.html&amp;via=dzhavatushev" class="btn btn-twitter">
    <span class="label">Share on Twitter</span>
  </a>
</p>

      </article>
    </main>

    <script src="/assets/js/main.js"></script>
  </body>
</html>
